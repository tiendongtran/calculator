<!DOCTYPE html>
<html lang="en">
<head>
<title>Calculator</title>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
  /* --- STYLES --- */
  :root {
    --bg-color: #1a1a24;
    --card-bg: #252530;
    --accent: #8ab4f8;
    --text: #ffffff;
    --text-muted: #aaaaaa;
    --border: #3f3f4e;
    --btn-hover: #333342;
  }

  body {
    font-family: sans-serif;
    background-color: transparent;
    color: var(--text);
    margin: 0;
    padding: 10px;
    -webkit-font-smoothing: antialiased;
  }

  .calculator-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    max-width: 450px;
    margin: 0 auto;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }

  /* Header Row */
  .header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border);
    padding-bottom: 10px;
    margin-bottom: 15px;
  }
  
  h2 { margin: 0; font-size: 1.1rem; }
  
  /* NAME BOX */
  .client-input {
    background: var(--bg-color);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 5px 8px;
    border-radius: 4px;
    width: 130px;
    font-size: 0.9rem;
    text-align: center; 
  }
  .client-input::placeholder { color: #555; }

  h3 { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; margin-top: 20px; margin-bottom: 8px; letter-spacing: 1px; }

  /* Grid for Base Price Buttons */
  .base-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .radio-label {
    background: var(--bg-color);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    cursor: pointer;
    transition: 0.2s;
    font-size: 0.9rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-height: 50px;
  }

  .radio-label:hover { border-color: var(--text-muted); background-color: var(--btn-hover); }
  
  input[type="radio"], input[type="checkbox"] { display: none; }

  /* Selected State */
  input[type="radio"]:checked + div {
    color: var(--accent);
    font-weight: bold;
    text-shadow: 0 0 5px rgba(138, 180, 248, 0.3);
  }
  input[type="radio"]:checked + div::after {
    content: " (Selected)";
    display: block;
    font-size: 0.7em;
    color: var(--text);
    font-weight: normal;
  }
  .radio-label:has(input:checked) {
      border-color: var(--accent);
      background-color: rgba(138, 180, 248, 0.05);
  }

  /* --- SLIDER --- */
  .slider-container { margin: 15px 0; }
  .slider-labels { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-top: 5px; }
  
  input[type=range] {
    width: 100%;
    accent-color: var(--accent);
    cursor: pointer;
  }

  /* --- CHECKBOX LIST --- */
  .checkbox-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 5px;
    border-bottom: 1px solid #333;
    cursor: pointer;
    transition: 0.2s;
  }
  .checkbox-item:hover { background-color: rgba(255,255,255,0.03); }
  .checkbox-item:last-child { border-bottom: none; }
  
  .checkbox-box {
    width: 20px; height: 20px;
    border: 2px solid var(--text-muted);
    border-radius: 3px;
    margin-right: 10px;
    position: relative;
    display: inline-block;
    background-color: transparent; 
    box-sizing: border-box;
  }
  
  /* Checkbox States */
  input[type="checkbox"]:checked + .checkbox-row .checkbox-box {
    background-color: var(--accent);
    border-color: var(--accent);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
    background-size: 80%;
    background-position: center;
    background-repeat: no-repeat;
  }
  
  /* Disabled State */
  .disabled-row { opacity: 0.4; pointer-events: none; }

  .checkbox-row { display: flex; align-items: center; width: 100%; transition: 0.2s; }
  .item-name { flex-grow: 1; font-size: 0.9rem; }
  .item-price { color: var(--accent); font-size: 0.8rem; font-weight: bold; }

  /* --- FOOTER / TOTAL --- */
  .footer-row {
    margin-top: 25px;
    padding-top: 15px;
    border-top: 2px dashed var(--border);
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
  }
  
  /* Left Column for Back Button + Tools */
  .footer-left-col {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .tools-area { display: flex; gap: 8px; }

  .tool-btn {
    background: var(--card-bg);
    border: 1px solid var(--border);
    color: var(--text-muted);
    font-size: 0.75rem;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: 0.2s;
    text-decoration: none;
    display: inline-block;
    line-height: normal;
  }
  .tool-btn:hover { color: var(--text); border-color: var(--accent); background: var(--bg-color); }

  .total-area { text-align: right; }
  .total-label { font-size: 0.8rem; color: var(--text-muted); }
  .total-price { font-size: 1.8rem; font-weight: bold; color: var(--accent); }

  #file-upload { display: none; }

</style>
</head>
<body>

<div class="calculator-card" id="capture-area">
  
  <div class="header-row">
    <h2>Commission Estimator</h2>
    <input type="text" id="client-name" class="client-input" placeholder="Name">
  </div>

  <h3>1. Base Price</h3>
  <div class="base-grid">
    <label class="radio-label">
      <input type="radio" name="base" value="20" onchange="calculate()">
      <div>Chibi<br>$20</div>
    </label>
    <label class="radio-label">
      <input type="radio" name="base" value="40" onchange="calculate()">
      <div>Portrait<br>$40</div>
    </label>
    <label class="radio-label">
      <input type="radio" name="base" value="60" onchange="calculate()">
      <div>Full Body<br>$60</div>
    </label>
    <label class="radio-label">
      <input type="radio" name="base" value="100" onchange="calculate()">
      <div>Full Scene<br>$100</div>
    </label>
  </div>

  <h3>2. Complexity</h3>
  <div class="slider-container">
    <input type="range" id="complexity" min="0" max="100" step="25" value="0" oninput="calculate()">
    <div class="slider-labels">
      <span>Simple<br>0%</span>
      <span>Medium<br>25%</span>
      <span>Detail<br>50%</span>
      <span>Complex<br>75%</span>
      <span>Max<br>100%</span>
    </div>
    <div style="text-align:center; margin-top:5px; font-size:0.8rem; color:var(--accent);">
      Current: +<span id="complexity-disp">0</span>%
    </div>
  </div>

  <h3>3. Add-ons</h3>
  
  <label class="checkbox-item">
    <input type="checkbox" id="check-separation" onchange="calculate()">
    <div class="checkbox-row">
      <span class="checkbox-box"></span>
      <span class="item-name">Layer Separation (Cut)</span>
      <span class="item-price">+100%</span>
    </div>
  </label>

  <h3>4. Usage & Files</h3>

  <label class="checkbox-item">
    <input type="checkbox" id="check-stream" onchange="handleUsage('stream')">
    <div class="checkbox-row" id="row-stream">
      <span class="checkbox-box"></span>
      <span class="item-name">Streaming</span>
      <span class="item-price">+50%</span>
    </div>
  </label>

  <label class="checkbox-item">
    <input type="checkbox" id="check-commercial" onchange="handleUsage('commercial')">
    <div class="checkbox-row">
      <span class="checkbox-box"></span>
      <span class="item-name">Commercial Use (includes Streaming)</span>
      <span class="item-price">+200%</span>
    </div>
  </label>

  <label class="checkbox-item">
    <input type="checkbox" id="check-spine" onchange="handleUsage('spine')">
    <div class="checkbox-row">
      <span class="checkbox-box"></span>
      <span class="item-name">Original Work File (Spine)</span>
      <span class="item-price">+300%</span>
    </div>
  </label>

  <label class="checkbox-item">
    <input type="checkbox" id="check-private-delay" onchange="handlePrivate('delay')">
    <div class="checkbox-row" id="row-private-delay">
      <span class="checkbox-box"></span>
      <span class="item-name">Private (Delayed Post)</span>
      <span class="item-price">+20%</span>
    </div>
  </label>

  <label class="checkbox-item">
    <input type="checkbox" id="check-private-perm" onchange="handlePrivate('perm')">
    <div class="checkbox-row" id="row-private-perm">
      <span class="checkbox-box"></span>
      <span class="item-name">Private (Never Post)</span>
      <span class="item-price">+50%</span>
    </div>
  </label>

  <div class="footer-row">
    
    <div class="footer-left-col">
        <a href="#" onclick="history.back(); return false;" class="tool-btn" id="btn-back">
            &laquo; Back
        </a>
        <div class="tools-area">
            <button class="tool-btn" id="btn-shot" onclick="saveScreenshot()">ðŸ“· Screenshot</button>
            <button class="tool-btn" id="btn-save" onclick="savePreset()">ðŸ’¾ Save</button>
            <button class="tool-btn" id="btn-load" onclick="document.getElementById('file-upload').click()">ðŸ“‚ Load</button>
            <input type="file" id="file-upload" accept=".json" onchange="loadPreset(this)">
        </div>
    </div>

    <div class="total-area">
      <div class="total-label">Estimated Total</div>
      <div class="total-price">$<span id="final-price">0</span></div>
    </div>
  </div>

</div>

<script>
  function calculate() {
    let base = 0;
    document.getElementsByName('base').forEach(radio => {
      if(radio.checked) base = parseInt(radio.value);
    });

    let slider = document.getElementById('complexity');
    let complexityPercent = parseInt(slider.value);
    document.getElementById('complexity-disp').innerText = complexityPercent;
    let complexityFee = base * (complexityPercent / 100);

    let artSubtotal = base + complexityFee;

    let sepFee = 0;
    if(document.getElementById('check-separation').checked) {
      sepFee = artSubtotal * 1.0;
    }

    let projectSubtotal = artSubtotal + sepFee;

    let usagePercent = 0;

    let isCommercial = document.getElementById('check-commercial').checked;
    let isStream = document.getElementById('check-stream').checked;

    if(isStream && !isCommercial) usagePercent += 0.50;
    if(isCommercial) usagePercent += 2.00;
    if(document.getElementById('check-spine').checked) usagePercent += 3.00;
    if(document.getElementById('check-private-delay').checked) usagePercent += 0.20;
    if(document.getElementById('check-private-perm').checked) usagePercent += 0.50;

    let usageFeeAmount = projectSubtotal * usagePercent;

    let total = projectSubtotal + usageFeeAmount;

    document.getElementById('final-price').innerText = Math.round(total);
  }

  // --- HANDLERS ---
  function handlePrivate(type) {
    let delayCb = document.getElementById('check-private-delay');
    let permCb = document.getElementById('check-private-perm');
    let delayRow = document.getElementById('row-private-delay');
    let permRow = document.getElementById('row-private-perm');

    delayRow.classList.remove('disabled-row');
    permRow.classList.remove('disabled-row');

    if (type === 'delay' && delayCb.checked) {
        permCb.checked = false; 
        permRow.classList.add('disabled-row'); 
    } 
    else if (type === 'perm' && permCb.checked) {
        delayCb.checked = false; 
        delayRow.classList.add('disabled-row'); 
    }
    calculate();
  }

  function handleUsage(type) {
    let spine = document.getElementById('check-spine');
    let comm = document.getElementById('check-commercial');
    let stream = document.getElementById('check-stream');
    let streamRow = document.getElementById('row-stream');

    if (type === 'spine' && spine.checked) comm.checked = true; 
    
    if (comm.checked) {
        stream.checked = true; 
        streamRow.classList.add('disabled-row'); 
    } else {
        streamRow.classList.remove('disabled-row');
        if(spine.checked) spine.checked = false;
    }
    calculate();
  }

  function saveScreenshot() {
    html2canvas(document.querySelector("#capture-area"), {
        backgroundColor: null,
        scale: 2,
        useCORS: true,
        onclone: function(clonedDoc) {
            // 1. Hide Buttons
            let leftCol = clonedDoc.querySelector('.footer-left-col');
            if(leftCol) {
                leftCol.style.visibility = 'hidden'; 
            }

            // 2. FORCE SLIDER RENDER
            let realSlider = clonedDoc.getElementById('complexity');
            if (realSlider) {
                let fakeContainer = clonedDoc.createElement('div');
                fakeContainer.style.position = 'relative';
                fakeContainer.style.height = '20px';
                fakeContainer.style.display = 'flex';
                fakeContainer.style.alignItems = 'center';
                fakeContainer.style.margin = '15px 0'; 

                let track = clonedDoc.createElement('div');
                track.style.width = '100%';
                track.style.height = '6px';
                track.style.backgroundColor = '#3f3f4e'; 
                track.style.borderRadius = '3px';
                track.style.position = 'absolute';
                track.style.top = '50%';
                track.style.transform = 'translateY(-50%)';

                let thumb = clonedDoc.createElement('div');
                let val = parseInt(realSlider.value);
                let max = parseInt(realSlider.max);
                let percent = val / max;
                
                thumb.style.width = '16px';
                thumb.style.height = '16px';
                thumb.style.backgroundColor = '#8ab4f8'; 
                thumb.style.borderRadius = '50%';
                thumb.style.position = 'absolute';
                thumb.style.top = '50%';
                thumb.style.transform = 'translateY(-50%)';
                thumb.style.left = `calc(${percent * 100}% - 8px)`;

                fakeContainer.appendChild(track);
                fakeContainer.appendChild(thumb);

                realSlider.parentNode.insertBefore(fakeContainer, realSlider);
                realSlider.style.display = 'none';
            }
        }
    }).then(canvas => {
        let link = document.createElement('a');
        
        // --- NEW FILENAME LOGIC ---
        let clientName = document.getElementById('client-name').value.trim() || "Client";
        
        let baseVal = 0;
        document.getElementsByName('base').forEach(radio => {
             if(radio.checked) baseVal = parseInt(radio.value);
        });
        
        let baseMap = {
            20: "Chibi",
            40: "Portrait",
            60: "FullBody",
            100: "FullScene"
        };
        let baseName = baseMap[baseVal] || "Custom";

        let compVal = parseInt(document.getElementById('complexity').value);
        let compMap = {
            0: "Simple",
            25: "Medium",
            50: "Detail",
            75: "Complex",
            100: "Max"
        };
        let compName = compMap[compVal] || compVal + "%";

        let filename = `Quote_${clientName}_${baseName}_${compName}.png`;
        filename = filename.replace(/ /g, "");

        link.download = filename;
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
  }

  function savePreset() {
    let data = {
        name: document.getElementById('client-name').value,
        base: Array.from(document.getElementsByName('base')).find(r => r.checked)?.value || 0,
        complexity: document.getElementById('complexity').value,
        separation: document.getElementById('check-separation').checked,
        stream: document.getElementById('check-stream').checked,
        commercial: document.getElementById('check-commercial').checked,
        spine: document.getElementById('check-spine').checked,
        delay: document.getElementById('check-private-delay').checked,
        perm: document.getElementById('check-private-perm').checked
    };
    let dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
    let link = document.createElement('a');
    link.href = dataStr;
    link.download = "commission_preset.json";
    link.click();
  }

  function loadPreset(input) {
    let file = input.files[0];
    if(!file) return;
    let reader = new FileReader();
    reader.onload = function(e) {
        let data = JSON.parse(e.target.result);
        document.getElementById('client-name').value = data.name || "";
        document.getElementsByName('base').forEach(r => { r.checked = (r.value == data.base); });
        document.getElementById('complexity').value = data.complexity || 0;
        document.getElementById('check-separation').checked = data.separation || false;
        document.getElementById('check-stream').checked = data.stream || false;
        document.getElementById('check-commercial').checked = data.commercial || false;
        document.getElementById('check-spine').checked = data.spine || false;
        document.getElementById('check-private-delay').checked = data.delay || false;
        document.getElementById('check-private-perm').checked = data.perm || false;
        
        handleUsage('restore'); 
        handlePrivate('restore'); 
        calculate();
    };
    reader.readAsText(file);
    input.value = '';
  }

  calculate();
</script>

</body>
</html>
